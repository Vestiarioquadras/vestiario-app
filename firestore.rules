// ğŸ”’ Regras de SeguranÃ§a Firestore para o Projeto VestiÃ¡rio
// Estas regras garantem que usuÃ¡rios sÃ³ possam acessar seus prÃ³prios dados

rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    
    // ğŸ“‹ Regras para coleÃ§Ã£o 'users'
    // UsuÃ¡rios sÃ³ podem ler/escrever seus prÃ³prios dados
    match /users/{userId} {
      // Permitir leitura e escrita apenas se o usuÃ¡rio estiver autenticado
      // e o userId corresponder ao UID do usuÃ¡rio autenticado
      allow read, write: if request.auth != null && request.auth.uid == userId;
      
      // Permitir criaÃ§Ã£o apenas se o usuÃ¡rio estiver autenticado
      // e o userId corresponder ao UID do usuÃ¡rio autenticado
      allow create: if request.auth != null 
        && request.auth.uid == userId
        && request.resource.data.keys().hasAll(['uid', 'email', 'role', 'name', 'createdAt'])
        && request.resource.data.uid == userId
        && request.resource.data.email == request.auth.token.email
        && request.resource.data.role in ['player', 'owner', 'court_owner'];
    }
    
    // ğŸŸï¸ Regras para coleÃ§Ã£o 'courts'
    // Donos podem gerenciar suas prÃ³prias quadras
    match /courts/{courtId} {
      // Permitir leitura para todos os usuÃ¡rios autenticados
      allow read: if request.auth != null;
      
      // Permitir escrita apenas para donos de quadras
      allow write: if request.auth != null 
        && request.auth.uid == resource.data.ownerId;
      
      // Permitir criaÃ§Ã£o apenas para usuÃ¡rios autenticados
      allow create: if request.auth != null 
        && request.resource.data.ownerId == request.auth.uid
        && request.resource.data.keys().hasAll(['name', 'sport', 'location', 'ownerId', 'createdAt']);
    }
    
    // ğŸ“… Regras para coleÃ§Ã£o 'bookings'
    // UsuÃ¡rios podem gerenciar suas prÃ³prias reservas
    match /bookings/{bookingId} {
      // Permitir leitura para o jogador que fez a reserva
      allow read: if request.auth != null 
        && request.auth.uid == resource.data.playerId;
      
      // Permitir escrita apenas para o jogador que fez a reserva
      allow write: if request.auth != null 
        && request.auth.uid == resource.data.playerId;
      
      // Permitir criaÃ§Ã£o apenas para usuÃ¡rios autenticados
      allow create: if request.auth != null 
        && request.resource.data.playerId == request.auth.uid
        && request.resource.data.keys().hasAll(['playerId', 'courtId', 'date', 'time', 'createdAt']);
    }
    
    // â­ Regras para coleÃ§Ã£o 'reviews'
    // UsuÃ¡rios podem gerenciar suas prÃ³prias avaliaÃ§Ãµes
    match /reviews/{reviewId} {
      // Permitir leitura para todos os usuÃ¡rios autenticados
      allow read: if request.auth != null;
      
      // Permitir escrita apenas para o autor da avaliaÃ§Ã£o
      allow write: if request.auth != null 
        && request.auth.uid == resource.data.authorId;
      
      // Permitir criaÃ§Ã£o apenas para usuÃ¡rios autenticados
      allow create: if request.auth != null 
        && request.resource.data.authorId == request.auth.uid
        && request.resource.data.keys().hasAll(['authorId', 'courtId', 'rating', 'comment', 'createdAt']);
    }
    
    // ğŸ† Regras para coleÃ§Ã£o 'sports'
    // Dados pÃºblicos, leitura para todos
    match /sports/{sportId} {
      allow read: if request.auth != null;
      // Permitir escrita para usuÃ¡rios autenticados (para populaÃ§Ã£o inicial)
      allow write: if request.auth != null;
    }
    
    // ğŸ¢ Regras para coleÃ§Ã£o 'clubs'
    // Donos podem gerenciar seus clubes
    match /clubs/{clubId} {
      // Permitir leitura para todos os usuÃ¡rios autenticados
      allow read: if request.auth != null;
      
      // Permitir escrita apenas para o dono do clube
      allow write: if request.auth != null 
        && request.auth.uid == resource.data.ownerId;
      
      // Permitir criaÃ§Ã£o apenas para usuÃ¡rios autenticados
      allow create: if request.auth != null 
        && request.resource.data.ownerId == request.auth.uid
        && request.resource.data.keys().hasAll(['name', 'location', 'ownerId', 'createdAt']);
    }
    
    // â¤ï¸ Regras para coleÃ§Ã£o 'favorites'
    // UsuÃ¡rios podem gerenciar seus prÃ³prios favoritos
    match /favorites/{favoriteId} {
      // Permitir leitura e escrita apenas para o dono do favorito
      allow read, write: if request.auth != null 
        && request.auth.uid == resource.data.userId;
      
      // Permitir criaÃ§Ã£o apenas para usuÃ¡rios autenticados
      allow create: if request.auth != null 
        && request.resource.data.userId == request.auth.uid
        && request.resource.data.keys().hasAll(['userId', 'courtId', 'createdAt']);
    }
    
    // ğŸ† Regras para coleÃ§Ã£o 'matches'
    // UsuÃ¡rios podem gerenciar suas prÃ³prias partidas
    match /matches/{matchId} {
      // Permitir leitura e escrita apenas para o jogador
      allow read, write: if request.auth != null 
        && request.auth.uid == resource.data.playerId;
      
      // Permitir criaÃ§Ã£o apenas para usuÃ¡rios autenticados
      allow create: if request.auth != null 
        && request.resource.data.playerId == request.auth.uid
        && request.resource.data.keys().hasAll(['playerId', 'date', 'createdAt']);
    }
    
    // ğŸ“… Regras para coleÃ§Ã£o 'blockedSlots'
    // Donos podem gerenciar horÃ¡rios bloqueados
    match /blockedSlots/{slotId} {
      // Permitir leitura para todos os usuÃ¡rios autenticados
      allow read: if request.auth != null;
      
      // Permitir escrita para usuÃ¡rios autenticados (temporariamente mais permissivo)
      allow write: if request.auth != null;
      
      // Permitir criaÃ§Ã£o para usuÃ¡rios autenticados
      allow create: if request.auth != null 
        && request.resource.data.keys().hasAll(['courtId', 'date', 'time', 'createdAt']);
    }
    
    // ğŸš« Negar acesso a todas as outras coleÃ§Ãµes
    match /{document=**} {
      allow read, write: if false;
    }
  }
}

// ğŸ“‹ INSTRUÃ‡Ã•ES PARA IMPLEMENTAR:
// 1. Acesse: https://console.firebase.google.com/
// 2. VÃ¡ em Firestore Database > Regras
// 3. Substitua as regras existentes pelo cÃ³digo acima
// 4. Clique em "Publicar"
// 5. Teste as regras usando o simulador de regras

// ğŸ” COMO TESTAR AS REGRAS:
// 1. No console Firebase, vÃ¡ em Firestore > Regras
// 2. Clique em "Simulador"
// 3. Configure um cenÃ¡rio de teste:
//    - Tipo: get, set, update, delete
//    - Local: /users/user123
//    - AutenticaÃ§Ã£o: Simulado
//    - UID: user123
// 4. Execute o teste e verifique se a regra funciona

// ğŸ›¡ï¸ BENEFÃCIOS DESTAS REGRAS:
// âœ… UsuÃ¡rios sÃ³ acessam seus prÃ³prios dados
// âœ… ProteÃ§Ã£o contra acesso nÃ£o autorizado
// âœ… Conformidade com LGPD
// âœ… SeguranÃ§a em tempo real
// âœ… ValidaÃ§Ã£o de dados na criaÃ§Ã£o
// âœ… Controle de acesso baseado em roles
